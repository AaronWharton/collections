# coding-route

## TCP/IP



### 遗漏补充

- 【EMI】：电磁干扰（Electromagnetic Interference 简称EMI），直译是电磁干扰。是指电磁波与电子元件作用后而产生的干扰现象，有传导干扰和辐射干扰两种。
- 【光纤】的基本成分是石英，只传光，不导电，不受电磁场的作用，在其中传输的光信号不受电磁场的影响，故光纤传输对电磁干扰、工业干扰有很强的抵御能力。也正因为如此，在光纤中传输的信号不易被窃听，因而利于保密。目前常用单模光纤和多模光纤，其中单模光纤相对来说成本高但衰耗较小。
- 【TLS】：安全传输层协议（Transport Layer Security）用于在两个通信应用程序之间提供保密性和数据完整性。该协议由两层组成： TLS 记录协议（TLS Record）和 TLS 握手协议（TLS Handshake）。较低的层为 TLS 记录协议，位于某个可靠的传输协议（例如 TCP）上面，与具体的应用无关，所以，一般把TLS协议归为传输层安全协议。
- 生成树协议
    - 广播风暴：指当广播数据充斥网络无法处理，并占用大量网络带宽，导致正常业务不能运行，甚至彻底瘫痪。
    - 生成树协议的产生原因：当两个以上的网桥使用时，由于存在级联的可能性，因此可能形成很多组的循环帧。当在这个网络中采用简单的洪泛转发帧，就会出现广播风暴。
    - 生成树协议（ STP ）：避免广播风暴、处理拓扑变化。 STP 通过在每个网桥禁用某些端口来工作可避免拓扑环路（指在两个网桥之间出现了重复路径）。
    - 网际协议数据单元（ BPDU ）：这些帧用来形成和维护生成树，来适应网桥的启用和关闭、接口卡更换或 MAC 地址改变。
    - 快速生成树协议（ RSTP ）：传统 STP 在拓扑变化之后，只能通过一定时间内未接收到 BPDU 来检测。若超时过大，收敛时间可能比预期大。 RSTP 改进：监听每个端口状态，并在故障时立即发送一个拓扑变化通知。收敛时间是指沿着生成树重新建立数据流的时间。
- 无线局域网——IEEE 802.11（ Wi-Fi ）
    - 接入点之间通常使用有线分布式服务（ DS ）连接，形成一个 ESS ， ESSID 是我们常说的 Wi-Fi 名。
    - 802.11帧（图P77）： MPDU 以 `帧控制字` 开始，其中包括2位的类型字段，用于识别该帧的类型。
      - 管理帧：用于创建、维持、终止站和接入点之间的连接。也被用于确定是否采用加密、传输网络名称（ SSID 或 ESSID ）、支持哪种传输速率，以及采用的时间数据库等。当一个 Wi-Fi 接口扫描临近的接入点时这些帧被用于提供必要的信息。
      - 控制帧：流量控制（ RTS/CTS ）、使用 ACK 扩展802.3重传机制。
      - 数据帧：携带数据，可分片、可聚合。

- 地址解析协议（ ARP ）
    -  IP 协议的设计目标是为跨越不同类型物理网络的分组交换提供互操作。这需要网络层软件使用的地址和底层网络硬件使用的地址之间进行转换。地址解析协议提供了一种在 IPv4 地址和各种网络技术使用的硬件地址之间的映射。而 IPv6 使用邻居发现协议。
    -  IP 地址和硬件地址（又称 MAC 地址或物理地址，48位）的区别与联系： IP 地址放在 IP 数据报的首部，而硬件地址放在 MAC 帧的首部，在网络层及以上使用的是 IP 地址，而数据链路层及以下使用的是硬件地址。因此在数据链路层看不到数据报的 IP 地址。
    - > 问题：既然在网络链路上传送的帧最终是按照硬件地址找到目的主机的，那么为什么我们不直接使用硬件地址进行通信，而是要使用抽象的 IP 地址并调用 ARP 来寻找出相应的硬件地址呢？
      - 解答：由于全世界存在着各种各样的网络，它们使用**不同的**硬件地址（这里我认为是指不同格式的意思）。要使这些异构网络能够相互通信就必须进行非常复杂的**硬件地址转换**工作，由用户或用户主机来完成这些事是不现实的。而用**统一的** IP 地址能很好地解决这个问题。
    - 通信特点：局域网通信使用 MAC 地址，跨网使用 IP 地址。数据包发送时包含了完整的 TCP/IP 四层信息，但是 IP 地址只在网络间（例如路由器连接不同的两个网络，一个网络上的 PC 机向另一个网络上的一个主机发送数据）寻址才起作用，在同一个网络内， IP 地址在发送端被转化为 MAC 地址进行寻址，而这种转化和交换的对应关系，依赖于 ARP 协议和 MAC 地址表。

- EDI(Electronic Data Interchange) ：电子数据交换。是由国际标准化组织（ISO）推出使用的国际标准，是指一种为商业或行政事务处理，按照一个公认的标准，形成结构化的事务处理或消息报文格式，从计算机到计算机的电子传输方法，也是计算机可识别的商业语言。例如，国际贸易中的采购订单、装箱单、提货单等数据的交换。
  - 发展背景：
    - 全球贸易额的上升带来了各种贸易单证、文件数量的激增。
    - 价格因素在竞争中所占的比重逐渐减小，而服务性因素所占比重增大。提高商业文件传递速度和处理速度成了所有贸易链中成员的共同需求。
      
  - 特点：
    - EDI使用电子方法传递信息和处理数据的。
    - EDI是采用统一标准编制数据信息的。
    - EDI是计算机应用程序之间的连接。
    - EDI系统采用加密防伪手段。
      
  - EDI 的优点：
    - 节约成本。
    - 速度及准确度。
    - 提升营商效率。
    - 在商业运营的策略层面也有优势。

  - 应用实例：
    一个传统企业简单的购货贸易过程:买方向卖方提出订单。卖方得到订单后，就进行它内部的纸张文字票据处理，准备发货。纸张票据中包括发货票等。买方在收到货和发货票之后，开出支票，寄给卖方。卖方持支票至银行兑现。银行再开出一个票据，确认这笔款项的汇兑。
    而一个生产企业的EDI系统，就是要把上述买卖双方在贸易处理过程中的所有纸面单证由EDI通信网来传送，并由计算机自动完成全部（或大部分）处理过程。具体为：企业收到一份EDI订单，则系统自动处理该订单，检查订单是否符合要求；然后通知企业内部管理系统安排生产；向零配件供销商订购零配件等；有关部门申请进出口许可证；通知银行并给订货方开出EDI发票；向保险公司申请保险单等。从而使整个商贸活动过程在最短时间内准确地完成。一个真正的EDI系统是将订单、发货、报关、商检和银行结算合成一体，从而大大加速了贸易的全过程。因此，EDI对企业文化、业务流程和组织机构的影响是巨大的。


### Internet地址结构

- 【IPv4映射的IPv6地址】、【IPv4兼容的IPv6地址】和【IPv6地址简化表示法】见P22。
- 【单播地址】：用于识别连接Internet或某些专用的内联网的计算机网络接口的IPv4地址块所细分的一个地址。
- 【分类寻址】：单播IP地址 = 网络（号/部分） + 主机（号/地址）。IPv4地址空间最初分为A、B、C（为单播地址中的接口分配地址）、D（供组播使用）、E（保留）类。缺点：出现规模问题、AB类网络号浪费主机号而C类网络号不能为很多站点提供足够的主机号。
- 【子网寻址】：在一个站点接入Internet后为其分配一个网络号。然后由站点管理员进一步划分本地的子网数。
- 【子网掩码】(subnet mask)：又叫网络掩码、地址掩码、子网络遮罩，它是一种用来指明一个IP地址的哪些位标识的是主机所在的子网，以及哪些位标识的是主机的位掩码。子网掩码不能单独存在，它必须结合IP地址一起使用。子网掩码只有一个作用，就是将某个IP地址划分成网络地址和主机地址两部分（从一台主机对应IP地址中获得网络和子网信息）。
- 【可变长度子网掩码】（VLSM）。


### 链路层

- 【TCP/IP协议族设计链路层的目的】：为IP模块发送和接受IP数据报。
- 【以太网】：以太网（Ethernet）指的是由Xerox公司创建并由Xerox、Intel和DEC公司联合开发的基带局域网规范，是当今现有局域网采用的最通用的通信协议标准。以太网络使用CSMA/CD（载波监听多路访问及冲突检测）技术，并以10M/S的速率运行在多种类型的电缆上。以太网与IEEE802.3系列标准相类似。包括标准的以太网（10Mbit/s)、快速以太网（100Mbit/s）和10G（10Gbit/s）以太网。它们都符合IEEE802.3。
- 【CSMA/CD】：载波监听多路访问及冲突检测，是一种争用型的介质访问控制（MAC，MAC协议有很多种）协议。它的工作原理是: 发送数据前 先侦听信道是否空闲 ,若空闲，则立即发送数据。若信道忙碌，则等待一段时间至信道中的信息传输结束后再发送数据；若在上一段信息发送结束后，同时有两个或两个以上的节点都提出发送请求，则判定为冲突。若侦听到冲突,则立即停止发送数据，等待一段随机时间,再重新尝试。
- 【以太网帧】（链路层的PDU（消息对象）通常叫做帧）开始是一个前导字段（接收器用它确定一个帧的到达时间并确定编码位之间的时间量），接着是SFD（帧起始分隔符，固定值为0xAB，接收器使用它“恢复时钟”），然后是48位的目的地址（DST）和源地址（SRC）字段，其中目的地址也允许寻址到多个站点（广播、组播），源地址后面紧跟着一个类型字段，或一个长度字段，多数情况下用于确定头部后面的数据类型。接着后面是帧的数据区或有效载荷部分，放高层UDP（例如IP数据报）的地方。最后循环冗余校验（CRC）字段位于尾部，有32位，也称IEEE/ANSI标准的CRC32[802.3-2008]（P59模2除法），在接收到数据之后，接收方执行相同的除法计算出余数，并判断该值与FCS字段的值是否匹配，这可用于提示信息受损。
- 【MTU】：通信术语 最大传输单元（Maximum Transmission Unit，MTU）是指一种通信协议的某一层上面所能通过的最大数据包大小（以字节为单位）。最大传输单元这个参数通常与通信接口有关（网络接口卡、串口等）。
- 【MTU的说明】：
  - 因为协议数据单元的包头和包尾的长度是固定的，MTU越大，则一个协议数据单元的承载的有效数据就越长，通信效率也越高。MTU越大，传送相同的用户数据所需的数据包个数也越低。
  - MTU也不是越大越好，因为MTU越大， 传送一个数据包的延迟也越大；并且MTU越大，数据包中 bit位发生错误的概率也越大。MTU越大，通信效率越高而传输延迟增大，所以要权衡通信效率和传输延迟选择合适的MTU。
- 【争用期】：又称碰撞窗口，指以太网的端到端往返时间`2τ`（规定为51.2μs，也说512比特时间或者64字节）。说明：**经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞**。
- 【截断二进制指数退避算法】：用以确定碰撞后重传的时机。P84
- 【生成树协议】
  - 广播风暴：指当广播数据充斥网络无法处理，并占用大量网络带宽，导致正常业务不能运行，甚至彻底瘫痪。
  - 生成树协议的产生原因：当两个以上的网桥使用时，由于存在级联的可能性，因此可能形成很多组的循环帧。当在这个网络中采用简单的洪泛转发帧，就会出现广播风暴。
  - 生成树协议（ STP ）：避免广播风暴、处理拓扑变化。 STP 通过在每个网桥禁用某些端口来工作可避免拓扑环路（指在两个网桥之间出现了重复路径）。
  - 网际协议数据单元（ BPDU ）：这些帧用来形成和维护生成树，来适应网桥的启用和关闭、接口卡更换或 MAC 地址改变。
  - 快速生成树协议（ RSTP ）：传统 STP 在拓扑变化之后，只能通过一定时间内未接收到 BPDU 来检测。若超时过大，收敛时间可能比预期大。 RSTP 改进：监听每个端口状态，并在故障时立即发送一个拓扑变化通知。收敛时间是指沿着生成树重新建立数据流的时间。
- 【无线局域网——IEEE 802.11（ Wi-Fi ）】
  - 接入点之间通常使用有线分布式服务（ DS ）连接，形成一个 ESS ， ESSID 是我们常说的 Wi-Fi 名。
  - 802.11帧（图P77）： MPDU 以 `帧控制字` 开始，其中包括2位的类型字段，用于识别该帧的类型。
    - 管理帧：用于创建、维持、终止站和接入点之间的连接。也被用于确定是否采用加密、传输网络名称（ SSID 或 ESSID ）、支持哪种传输速率，以及采用的时间数据库等。当一个 Wi-Fi 接口扫描临近的接入点时这些帧被用于提供必要的信息。
    - 控制帧：流量控制（ RTS/CTS ）、使用 ACK 扩展802.3重传机制。
    - 数据帧：携带数据，可分片、可聚合。
- 【MRU 、 MTU 和路径MTU】
  - MRU ： 链路的最大接收单元。
  - MTU ： 见上描述。
  - 路径MTU ： 在包含所有链路的 网络路径上，最小的 MTU 称为路径MTU。
- 【环回】：一种能让客户机使用 Internet 协议（例如 TCP/IP ）与**同一计算机**上的服务器通信的能力。它通常使用一个**虚拟的**环回**网络接口**来实现。以127开始的 IPv4 地址就是为这个目的而保留， IPv6 地址 ::1 用于同样的目的。类 UNIX 系统为环回接口分配的 IPv4 地址为 127.0.0.1 （ IPv6 地址为 ::1 ），为它 的名称为 localhost。**发送到环回接口的IP数据报不会出现在任何网络中**。这使得环回接口可用于服务调试、性能测试等功能（例如在学习 php 、 golang 时我们经常使用到 localhost 以及某些端口）。


### 地址解析协议（ ARP ）

- IP 协议的设计目标是为跨越不同类型物理网络的分组交换提供互操作。这需要网络层软件使用的地址和底层网络硬件使用的地址之间进行转换。地址解析协议提供了一种在 IPv4 地址和各种网络技术使用的硬件地址之间的映射。而 IPv6 使用邻居发现协议。
- IP 地址和硬件地址（又称 MAC 地址或物理地址，48位）的区别与联系： IP 地址放在 IP 数据报的首部，而硬件地址放在 MAC 帧的首部，在网络层及以上使用的是 IP 地址，而数据链路层及以下使用的是硬件地址。因此在数据链路层看不到数据报的 IP 地址。
- > 问题：既然在网络链路上传送的帧最终是按照硬件地址找到目的主机的，那么为什么我们不直接使用硬件地址进行通信，而是要使用抽象的 IP 地址并调用 ARP 来寻找出相应的硬件地址呢？
  - 解答：由于全世界存在着各种各样的网络，它们使用**不同的**硬件地址（这里我认为是指不同格式的意思）。要使这些异构网络能够相互通信就必须进行非常复杂的**硬件地址转换**工作，由用户或用户主机来完成这些事是不现实的。而用**统一的** IP 地址能很好地解决这个问题。
- 通信特点：局域网通信使用 MAC 地址，跨网使用 IP 地址。数据包发送时包含了完整的 TCP/IP 四层信息，但是 IP 地址只在网络间（例如路由器连接不同的两个网络，一个网络上的 PC 机向另一个网络上的一个主机发送数据）寻址才起作用，在同一个网络内， IP 地址在发送端被转化为 MAC 地址进行寻址，而这种转化和交换的对应关系，依赖于 ARP 协议和 MAC 地址表。


###  Internet 协议

- 【IPv4 头部和 IPv6 头部】：基本 IPv4 头部20字节，但是不是固定的20字节（因为可能存在选项）， IPv6 头部长度是固定的40字节，它没有任何选项，但是有扩展头部。

- 【专用地址（ private address ）】：在 Internet 中的所有路由器，对目的地址是专用地址的数据报一律不进行转发。    
(1)10.0.0.0-10.255.255.255      或记为10.0.0.0/8，又称24位块    
(2)172.16.0.0-172.31.255.255    或记为172.16.0.0/12，又称20位块    
(3)192.168.0.0-192.168.255.255  或记为192.168.0.0/16，又称16位块    
专用地址用于解决企业接入 Internet ，节约全球 IP 地址（优点），但是一个企业接入 Internet 的灵活性降低（主要表现在主机重新编排专用地址上，如企业专用网合并解决专用地址的冲突）（缺点）。

- 【 NAT 】：网络地址转换，当专用网内部需要与 Internet 上的主机通信时，需要使用 NAT 来进行通信。这种方法需要在专用网连接到 Internet 的路由器上安装 NAT 软件。装有 NAT 软件的路由器叫做 NAT 路由器，它**至少有一个有效的外部全球 IP 地址**，当 NAT 路由器具有 n （ n >= 1 ） 个全球 IP 地址时，专用网内最多可以同时有 n 个主机接入到 Internet 。显然，通过 NAT 路由器的通信必须由专用网内的主机发起，这表明，专用网内的主机无法当作服务器使用。为了更加有效利用 NAT 路由器上的全球 IP 地址，现在常用 NAT 转换表把运输层的端口号耶利用上，使多个拥有本地地址的主机可以共用一个 NAT 路由器上的全球 IP 地址，因而可以**同时**和 Internet 上的不同主机进行通信。








## Docker


### 杂记

- 虚拟化一般分为硬件级虚拟化（模拟一个完整的操作系统，比如一个虚拟机）和操作系统级虚拟化（模拟运行在操作系统上的多个不同进程并将其封装在容器里，比如封装在 `Docker` 里面）。
- 容器和虚拟机有很大不同。容器其实就是运行在操作系统上的一个进程，只不过加入了对资源的限制和隔离（这点比较重要，因为传统上默认进程间共用了CPU和内存，会遇到相互干扰的问题）。 `Docker` 在易用性和稳定性上做了很大改善，三大核心功能是 `CGroup`  `Namespace` 和 `UnionFS`。 `CGroup` 技术用来限定一个进程的资源使用， `Namespace` 技术用来划分不同的命名空间，也就是通常所说的隔离容器，而 `UnionFS` 则是用来处理分层镜像的功能，使镜像更加轻量级和快速。
- `Docker` 包括三个基本概念——镜像，容器和仓库，容器和镜像是 `Docker` 最核心的部分，使用 `Docker` 时实际就是在容器里面运行一个镜像，镜像是一个**只读**的模板(镜像就是容器中的一个文件系统)。仓库是集中放镜像文件的场所。


### Docker命令

- `docker run -i -t ubuntu /bin/bash` ：运行一个可交互的ubuntu容器
  - `-i` ：表示启动一个可交互的容器（在ubuntu下，退出交互界面可直接关闭终，或者CTRL+PQ。若要使容器停止运行则可用exit退出或者在终端使用kill/stop）
  - `-t` ：表示使用pseudo-TTY，关联到容器的stdin和stdout
  - `ubuntu` ：表示要运行的镜像（即image，可用docker images查看需要使用的image名称）
  - `/bin/bash` ：表示启动容器时需要运行的命令
  
- `docker kill ubuntu` ：发送SIGKILL信号，应用程序直接退出
- `docker stop ubuntu` ：支持“优雅退出”，先发送SIGTERM信号，在一段时间之后（10s？）再发送SIGKILL信号。 `Docker` 内部的应用程序可以接收SIGTERM信号，然后做一些退出前工作（保存状态或者处理当前请求等，线上应用考虑使用此优雅的方法）
- `docker ps -a` ：查看所有容器（若不加参数-a则显示正在运行的容器）
- 一键停用并删除所有容器： `docker stop $(docker ps -q) & docker rm $(docker ps -aq)`
- 将容器转换为镜像（先使用 `exit` 退出容器）： `docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]`。
  - OPTIONS说明：
    - -a :提交的镜像作者；
    - -c :使用Dockerfile指令来创建镜像；
    - -m :提交时的说明文字；
    - -p :在commit时，将容器暂停。
  - CONTAINER说明：CONTAINER ID或者NAMES（使用 `docker ps -a` 查看）。
  - REPOSITORY[:TAG]说明：转化后的镜像名和版本号。
  - 转化后可使用 `docker images` 查看自己新建的镜像。
- 有时候命令不起作用，试试先stop（所有）容器？


## Shell

- 变量名赋值时注意：变量名和等号之间不能有空格。
- 表达式和运算符之间要有空格，例如``` 2+2 ```是不对的，必须写成``` 2 + 2 ```。
- 完整的表达式使用的是反引号``` ` ```而不是单引号``` ' ```。
- 条件表达式要放在方括号之间，并且要有空格，例如: ``` [$a==$b] ```是错误的，必须写成``` [ $a == $b ] ```。
- 乘号(``` * ```)前边必须加反斜杠(``` \ ```)才能实现乘法运算。
- case的语法和C family语言差别很大，它需要一个``` esac ```（就是case反过来）作为结束标记，每个case分支用右圆括号，用两个分号表示break。
